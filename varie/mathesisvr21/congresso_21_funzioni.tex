
%--------------------------% Inizio comandi per l'ambiente math
% QUANDO SI MODIFICA UNO DI QUESTI BISOGNA 
% MODIFICARE ANCHE IL FILE DI CONFIGURAZIONE: md_make4ht.cfg

% Insiemi numerici:
\newcommand{\N}{\ensuremath{\mathbb{N}}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\Q}{\mathbb{Q}}
\newcommand{\Nz}{\mathbb{N}^0}
\newcommand{\Zz}{\mathbb{Z}^0}
\newcommand{\Qz}{\mathbb{Q}^0}
\newcommand{\A}{\mathbb{A}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Rz}{\mathbb{R}^0}
\newcommand{\Rp}{\mathbb{R}^+}
\newcommand{\IR}{{}^*\hspace{-.12em}\mathbb{R}} % Iperreali
\newcommand{\C}{\mathbb{C}}
\newcommand{\IC}{{}^*\hspace{-.12em}\mathbb{C}} % Ipercomplessi
\newcommand{\K}{\mathbb{K}}
\newcommand{\effestar}{{}^*\hspace{-.15em}f}
% \newcommand{\fstar}[1][f]{{}^*\!#1}
\newcommand{\fstar}[1]{{}^*\hspace{-.25em}#1}
\newcommand{\ID}{I.D.}
\newcommand{\II}{I.I.}

%--------------------------
% varianti di lettere greche:
\renewcommand{\epsilon}{\varepsilon}
\renewcommand{\theta}{\vartheta}
\renewcommand{\rho}{\varrho}
\renewcommand{\phi}{\varphi}

%--------------------------
% Delimitatori e parentesi:
\newcommand{\tonda}[1]{\left( #1 \right)}
\newcommand{\quadra}[1]{\left[ #1 \right]}
% \newcommand{\rquadra}[1]{\left] #1 \right[} % Quadra rovescia: Deprecata
\newcommand{\graffa}[1]{\left \{ #1 \right \}}
% \newcommand{\abs}[1]{\left \lvert #1 \right \rvert} %usare modulo
\newcommand{\modulo}[1]{\left| #1 \right|}
\newcommand{\angolare}[1]{\left \langle #1 \right \rangle}

%--------------------------
% Sisteni, vettori, matrici:
\newcommand{\sistema}[1]{\left\{\begin{array}{lcl}#1\end{array}\right.}
\newcommand{\fatratti}[1]{\left\{\begin{array}{lclcl}#1\end{array}\right.}
\newcommand{\vettore}[1]{\left(\begin{array}{c}#1\end{array}\right)}
\newcommand{\matrice}[2]{\tonda{\begin{array}{#1}#2\end{array}}}
\newcommand{\vect}[1]{\overrightarrow{#1}}
\newcommand{\coppia}[2]{\tonda{#1;~#2}}
\newcommand{\punto}[3]{#1\tonda{#2;~#3}}
\newcommand{\Deriv}[1]{\mathit{D}\quadra{#1}}

%--------------------------
% Intervalli:
\newcommand{\intervcc}[2]{\left[#1;~#2\right]}
\newcommand{\intervac}[2]{\left]#1;~#2\right]}
\newcommand{\intervca}[2]{\left[#1;~#2\right[}
\newcommand{\intervaa}[2]{\left]#1;~#2\right[}

%--------------------------
% simboli con l'aggiunta di uno spazio prima e dopo:
\newcommand{\sand}{~ \wedge ~}
\newcommand{\sor}{~ \vee ~}
\newcommand{\scap}{~ \cap ~}
\newcommand{\scup}{~ \cup ~}
\newcommand{\svert}{~ \vert ~}
\newcommand{\sLarrow}{~ \Leftarrow ~}
\newcommand{\sLRarrow}{~ \Leftrightarrow ~}
\newcommand{\sRarrow}{~ \Rightarrow ~}
\newcommand{\slarrow}{~ \leftarrow ~}
\newcommand{\slrarrow}{~ \leftrightarrow ~}
\newcommand{\srarrow}{~ \rightarrow ~}
\newcommand{\stext}[1]{~~\text{#1}~~}
\newcommand{\sstext}[1]{\quad\text{#1}\quad}

%--------------------------
% Operatori per le funzioni circolari e per gli Iperreali:
\DeclareMathOperator{\sen}{sin}
\DeclareMathOperator{\tg}{tg}
\DeclareMathOperator{\st}{st}              % standard
\newcommand{\pst}[1]{\st \tonda{#1}}       % parte standard di 
\DeclareMathOperator{\monade}{mon}         % monade
\newcommand{\mon}[1]{\monade \tonda{#1}}   % monade di 
\DeclareMathOperator{\Galassia}{Gal}       % Galassia
\newcommand{\Gal}[1]{\Galassia \tonda{#1}} % Galassia di 
\DeclareMathOperator{\oinf}{inf}
\renewcommand{\inf}[1]{\oinf \tonda{#1}}   % Estremo inferiore
\DeclareMathOperator{\osup}{sup}
\renewcommand{\sup}[1]{\osup \tonda{#1}}     % Estremo superiore
\DeclareMathOperator{\omin}{min}
\renewcommand{\min}[1]{\omin \tonda{#1}}     % Minimo
\DeclareMathOperator{\omax}{max}
\renewcommand{\max}[1]{\omax \tonda{#1}}     % Massimo

\DeclareMathOperator{\divint}{~div~}
\DeclareMathOperator{\mcd}{MCD}
\DeclareMathOperator{\mcm}{mcm}

%--------------------------% Fine comandi per l'ambiente math

%--------------------------% Funzioni per le presentazioni

\newcommand{\initslides}{
% Le prime due slide della presentazione: titolo e TOC
\begin{frame}
\maketitle
\end{frame}

\begin{frame}[allowframebreaks]
\frametitle{Piano della presentazione}
% \begin{multicols}{2}
\tableofcontents
% \end{multicols}
\end{frame}
}
\newcommand{\md}{\orange{Matematica Dolce}~}

%--------------------------% Fine funzioni per le presentazioni

%--------------------------% Funzioni per la formattazione del testo

\newcommand{\affiancati}[4]{% 2 minipage affiancate
% Esempio di chiamata:
% \affiancati{.48}{.48}{testo1}{testo2}
  \def \larga{#1}
  \def \largb{#2}
%   \def \contenutoa{#3}
%   \def \contenutob{#4}
  \noindent\begin{minipage}{\larga\textwidth}
    #3
  \end{minipage}
  \hfill
  \begin{minipage}{\largb\textwidth}
    #4
  \end{minipage}
}

\newcommand{\affiancatic}[4]{% 2 minipage affiancate con contenuto centrato
% Esempio di chiamata:
% \affiancati{.48}{.48}{testo1}{testo2}
  \def \larga{#1}
  \def \largb{#2}
  \def \contenutoa{#3}
  \def \contenutob{#4}
  \noindent \begin{minipage}{\larga\textwidth}
    \begin{center} \contenutoa \end{center}
  \end{minipage}
  \hfill
  \begin{minipage}{\largb\textwidth}
    \begin{center} \contenutob \end{center}
  \end{minipage}
}

%--------------------------% Fine funzioni per la formattazione del testo

%--------------------------% Libreria grafica

\newcommand{\disegno}[2][5]{% Recomanded
  % Esempio di chiamata:
  %% 
  \def \dimensione{#1}
  \def \grafico{#2}
\begin{tikzpicture}[x=\dimensione mm, y=\dimensione mm, smooth]
  \grafico
\end{tikzpicture}
}

\newcommand{\asse}[4]{% Asse orizzontale.
  % Esempio di chiamata:
  %% \disegno{\asse{-7}{+7}{0}{\(t\)}
  \def \xmi{#1}
  \def \xma{#2}
  \def \posy{#3}
  \def \var{#4}
  \draw [-{Stealth[length=2mm, open, round]}] 
        (\xmi-.3, \posy) -- (\xma+.3, \posy);
  \node [below] at (\xma, \posy) {\var};
}

\newcommand{\rcomvar}[7]{% Riferimento Cartesiano Ortogonale Monometrico.
  % Esempio di chiamata:
  %% \disegno{\rcomvar{-7}{+7}{-11}{+10}{gray!50, very thin, step=1}}{t}{s}
  \def \xmi{#1}
  \def \xma{#2}
  \def \ymi{#3}
  \def \yma{#4}
  \def \griglia{#5}
  \def \vascissa{#6}
  \def \vordinata{#7}
  \draw[#5] (\xmi-0.3, \ymi-0.3) grid (\xma+0.3, \yma+0.3); % Griglia
  \begin{scope}[-{Stealth[length=2mm, open, round]}, black] % Assi
    \draw (\xmi-0.3, 0) -- (\xma+0.5, 0) 
      node [below, xshift=-3pt] {\vascissa};
    \draw (0, \ymi-0.3) -- (0, \yma+0.5) 
      node [left, yshift=-3pt] {\vordinata};
  \end{scope}
}
\newcommand{\rcom}[5]{% Riferimento Cartesiano Ortogonale Monometrico: x-y.
  % Esempio di chiamata:
  %% \disegno{\rcom{-7}{+7}{-11}{+10}{gray!50, very thin, step=1}}
  \rcomvar{#1}{#2}{#3}{#4}{#5}{\(x\)}{\(y\)}
}

\newcommand{\microscopio}[7]{% 
  % Esempio di chiamata:
  % \microscopio{punto}{lung}{angoloa}{angolob}{raggio}
  %             {postoetichetta}{etichetta}
  % \microscopio{(8, 5)}{2}{120}{-50}{2}{(7.6, 10)}{\infty}
  \def \punto{#1}
  \def \lung{#2}
  \def \anga{#3}
  \def \angb{#4}
  \def \rad{#5}
  \def \postimes{#6}
  \def \labeltimes{#7}
  \draw [color=gray, fill=white, line join=round] \punto -- +(\anga: \lung)
        arc [start angle=\angb, delta angle=350, radius=\rad] -- cycle;
  \node [gray] at \postimes {\footnotesize \labeltimes};
}

\newcommand{\freccia}[4]{
  \def \pp{#1}
  \def \pa{#2}
  \def \poslabel{#3}
  \def \value{#4}
  \draw [-{Latex[length=2mm, width=1mm]}, black] \pp 
    node[\poslabel]{\footnotesize \(\value\)} -- \pa; 
}

%--------------------------% Fine Libreria grafica

%--------------------------% Funzioni grafiche

\newcommand{\puntomedio}{% Punto medio di un segmento
    \disegno{
      \rcom{-3}{+10}{-2}{+8}{gray!50, very thin, step=1}
      \coordinate (a) at (2, 3);
      \coordinate (b) at (8, 6);
      \coordinate (m) at ($ (a)!.5!(b) $);
      \draw [-] (a) -- (b);
      \filldraw (a) circle (1.5pt) node [below right] {A};
      \filldraw (b) circle (1.5pt) node [below right] {B};

      \begin{scope}[dotted]
      \draw [-] (a) -- (2, 0) node [below] {$x_A$};
      \draw [-] (a) -- (0, 3) node [left] {$y_A$};
      \draw [-] (b) -- (8, 0) node [below] {$x_B$};
      \draw [-] (b) -- (0, 6) node [left] {$y_B$};
      \begin{scope}[red]
      \filldraw (m) circle (1.5pt) node [below right] {M};
      \draw [-] (m) -- (5, 0) 
        node [below, xshift=2pt] {$\dfrac{x_{A}+x_{B}}{2}$};
      \draw [-] (m) -- (0, 4.5) 
        node [left, yshift=2pt] {$\dfrac{y_{A}+y_{B}}{2}$};
      \end{scope}
      \end{scope}
    }
}

\newcommand{\lungseg}{% Segmento qualunque
    \disegno{
      \rcom{-5}{+5}{-5}{+5}{gray!50, very thin, step=1}
      \foreach \pos/\lab in {(0, 4)/R, (0, -2)/S, (-4, 0)/H, (3, 0)/K}
      \coordinate (e) at (-3, -4);
      \coordinate (f) at (2, 4);
      \coordinate (g) at (2, -4);
      \draw [-] (e) -- (f);
      \filldraw (e) circle (1.5pt) node [below right] {E};
      \filldraw (f) circle (1.5pt) node [below right] {F};
      \filldraw (g) circle (1.5pt) node [below right] {G};

      \begin{scope}[dotted]
      \draw [-] (e) -- (g) 
        node [below, xshift=1mm] at ($(e)!.5!(g)$) {$x_F - x_E$};
      \draw [-] (f) -- (g) 
        node [below, xshift=8mm] at ($(f)!.5!(g)$) {$y_F - y_E$};
      \end{scope}
    }
}

\newcommand{\areasottesauno}{% Area sottesa a un segmento
    \disegno{
      \coordinate (a) at (1, 3);
      \coordinate (xa) at (1, 0);
      \coordinate (ya) at (0, 3);
      \coordinate (b) at (7, 8);
      \coordinate (xb) at (7, 0);
      \coordinate (yb) at (0, 8);

      \fill [top color=green!30!black!20,bottom color=green!50!black!10] 
      (a) -- (b) -- (xb) -- (xa) -- cycle;

      \rcom{-1}{+9}{-1}{+9}{gray!50, very thin, step=1}
      
      \draw [-] (a) -- (b);
      \filldraw (a) circle (1.5pt) node [below right] {A};
      \filldraw (b) circle (1.5pt) node [below right] {B};

      \begin{scope}[dotted]
      \draw [-] (a) -- (xa) node [below] {$A'$};
      \draw [-] (a) -- (ya) node [left] {$y_A$};
      \draw [-] (b) -- (xb) node [below] {$B'$};
      \draw [-] (b) -- (yb) node [left] {$y_B$};
      \end{scope}
    }
}

\colorlet{anglecolor}{green!30!black}
\colorlet{sincolor}{blue!50!black}
% \colorlet{coscolor}{red!50!black}
% \colorlet{tancolor}{orange!70!black}


\newcommand{\diseqsin}[6]{%
% Soluzione della disequazione $\sin x \in [a;~b]$ 
% nella circonferenza goniometrica e nella sinusoide.
% Chiamata tipica: 
% \diseqsin{-.5}{1.73205080757 / 2}{0}{60}{120}{210}{330}{360}

% Parametri
  \def \psina{#1}
  \def \psinb{#2}
  \def \padeg{#3}
  \def \pbdeg{#4}
  \def \pcdeg{#5}
  \def \pddeg{#6}
  \def \_deg2rad{0.01745329252}
  \def \parad{#3*\_deg2rad}
  \def \pbrad{#4*\_deg2rad}
  \def \pcrad{#5*\_deg2rad}
  \def \pdrad{#6*\_deg2rad}
% Assi
  \begin{scope}[-{Stealth[length=2mm, open, round]}]
    \draw (-2.1,0) -- (6.5, 0) node [below] {$x$}; % Asse x
    \draw (-1, -1.3) -- (-1, 1.3) node [left] {$y'$}; % Asse y'
    \draw (0, -1.3) -- (0, 1.3) node [left] {$\sin x$}; % Asse y
    \foreach \y in {-1, -.5, +.5, +1}{
      \draw [-] (-0.02, \y) -- (+0.05, \y);}
  \end{scope}
% Circonferenza
  \coordinate (a) at (-1, 0);
  \coordinate (b) at (0, 0);
  \node(c0) at (a)[draw, circle through=(b)] {};  
% Tacche con etichetta asse x
  \begin{scope}[font=\tiny]
  \foreach \x/\xtext in {
      0.0/0, 0.5236/30, 1.047/60, 1.571/90, 2.094/120, 2.618/150, 
      3.142/180, 3.665/210, 4.189/240, 4.712/270, 5.236/300, 5.76/330, 
      6.283/360}
  \node[below] at(\x, 0) {$\xtext$};
  \end{scope}
% Tacche asse x
  \begin{scope}[font=\tiny]
  \foreach \x in { 
      0.0, 0.2618, 0.5236, 0.7854, 1.047, 1.309, 1.571, 1.833, 
      2.094, 2.356, 2.618, 2.88, 3.142, 3.403, 3.665, 3.927, 
      4.189, 4.451, 4.712, 4.974, 5.236, 5.498, 5.76, 6.021, 6.283}
  {\draw [black] (\x, -0.02) -- (\x, +0.05) node (a) {};}
  \end{scope}
%Sinusoide
  \tkzInit[xmin=0,xmax=+6.5,ymin=-1.1,ymax=+1.1]
  \tkzFct[domain=0:+6.5, thick, sincolor]{sin(x)}
% Tratto di sinusoide evidenziata PECCATO CHE NON FUNZIONI!!!
%   \tkzFct[domain=\parad:\pbrad, thick, decoration=snake]{sin(x)}
% Segmenti
  \begin{scope}[sincolor, thick]
  \foreach \x in {-1, 0} 
    {\draw [decorate, snake=snake, segment length=5pt, segment amplitude=2pt] 
    (\x, \psina) -- (\x, \psinb);}
  \foreach \x in {-1, 0} 
    {\filldraw (\x, \psina) circle(1.5pt) (\x, \psinb) circle(1.5pt);}
  \draw (-2.1, \psina) coordinate (pt0a) -- (+6.5, \psina) coordinate (pt1a);
  \draw (-2.1, \psinb) coordinate (pt0b) -- (+6.5, \psinb) coordinate (pt1b);
  \end{scope}
% Intersezioni
  \coordinate (ca) at (intersection 1 of c0 and pt0a--pt1a);
  \coordinate (cb) at (intersection 1 of c0 and pt1a--pt0a);
  \coordinate (cc) at (intersection 1 of c0 and pt0b--pt1b);
  \coordinate (cd) at (intersection 1 of c0 and pt1b--pt0b);
  \begin{scope}[anglecolor]
  \foreach \p in {(ca), (cb), (cc), (cd)}
    {\filldraw (-1, 0) -- \p [fill] circle(1.5pt);}
% Soluzioni
  \foreach \xp/\yp in {\parad/\psina, \pbrad/\psinb, 
                       \pcrad/\psinb, \pdrad/\psina}
    {\filldraw (\xp, 0) [anglecolor] circle(1.5pt) -- 
               (\xp, \yp) [sincolor] circle(1.5pt);}
  \draw [decorate, decoration=snake, segment length=5pt, 
         segment amplitude=2pt, anglecolor] 
        (\parad, 0) -- (\pbrad, 0);
  \draw [decorate, decoration=snake, segment length=5pt, 
         segment amplitude=2pt, anglecolor] 
        (\pcrad, 0) -- (\pdrad, 0);

  \draw (\parad, 0) [fill] circle(2pt); 
  \draw (\pbrad, 0) [fill] circle(2pt);
  \draw (\pcrad, 0) [fill] circle(2pt); 
  \draw (\pdrad, 0) [fill] circle(2pt);
% Angoli
  \draw [decorate, decoration=snake, segment length=5pt, 
         segment amplitude=2pt] 
        (ca) arc(\padeg:\pbdeg:1);
  \draw [decorate, decoration=snake, segment length=5pt,
         segment amplitude=2pt] 
        (cd) arc(\pcdeg:\pddeg:1);
  \end{scope}
}

\newcommand{\disequazionegon}{
  \disegno[10]{\diseqsin{.5}{1.73205080757 / 2}{30}{60}{120}{150}}
}

\newcommand{\grafoscatolasd}[4]{% 
  % Funzione binaria rappresentata come scatola nera a sinistra
  % esempio di chiamata:
  % \grafoscatolasx{add}{\(o_1\)}{\(o_2\)}{somma}
  \def \nomef{#1}
  \def \opa{#2}
  \def \opb{#3}
  \def \risultato{#4}
  \disegno[10]{
     \node [draw, fill=blue!20, minimum size=3em, rounded corners] 
            at (0, 0) (block 1) {\nomef};
     \draw [->] (-1, +0.5) node [left] {$\opa$} -- (block 1);
     \draw [->] (-1, -0.5) node [left] {$\opb$} -- (block 1);
     \draw[->] (block 1.east) -- (1, 0) node [right] {$\risultato$};
  }
}

\newcommand{\grafoportad}[5][1]{% 
  % Funzione binaria rappresentata come porta logica
  % esempio di chiamata:
  % \grafoportad[3]{add}{o_1}{o_2}{somma}
  \def \dim{#1}
  \def \nomef{#2}
  \def \opa{#3}
  \def \opb{#4}
  \def \risultato{#5}
  \def \ddim{2*\dim}
  \disegno{
    \draw (0, 0) node {\nomef} (-\dim, +\dim) -- (-\dim, -\dim) 
      arc [start angle=-90, end angle=90, x radius=\ddim, y radius =\dim]
      -- cycle;
     \draw (-1.5*\dim, .5*\dim) node [left=-4pt] {$\boxed{\opa}$} -- 
       (-\dim, .5*\dim)
       (-1.5*\dim, -.5*\dim) node [left=-4pt] {$\boxed{\opb}$} -- 
       (-\dim, -.5*\dim)
       (+\dim, 0) -- (+1.5*\dim, 0) 
       node [right=-4pt] {$\boxed{\risultato}$};
  }
}

\newcommand{\frecciav}[4]{% Freccia verticale.
  % Esempio di chiamata:
  % \frecciav{-.25}{-.04}{-.12}{}
  \def \posx{#1}
  \def \ymi{#2}
  \def \yma{#3}
  \def \lab{#4}
%   \draw [-{Stealth[length=2mm, round]}] (\posx, \yma) -- (\posx, \ymi);
  \draw [-{Straight Barb[length=4pt,width=2pt, round]}] 
         (\posx, \yma) -- (\posx, \ymi);
  \node [above] at (\posx, \yma) {\lab};
}

\newcommand{\rettaappross}{% 
  % Alcuni punti del segmento 0-1.
  \asse{-8}{+8}{0}{};
%   \foreach \x in {.02, .04, ..., .3}{
  \foreach \x in {.1, .2, .4, .8, 1.6, 3.2}{
    \draw (-\x, 0) arc [start angle=0, end angle=+20, radius=.8];
    \draw (\x, 0) arc [start angle=180, end angle=160, radius=.8];}
}

\newcommand{\unoconnome}{% 
  % Sezione con elementi separatori di cui due con nome
\disegno{
  \rettaappross
  \frecciav{-2.5}{-.4}{-1.2}{}
  \frecciav{2.5}{-0.4}{-1.2}{}
  \node at(-.8, .4)[above] {\(q_1\)};
  \node at(1.6, .4) [above] {\(q_2\)};
  \draw [<->] (-2.4, -1.2) -- node [below] {\(\frac{1}{n}\)} (2.4, -1.2);
  \microscopio{(0, .2)}{1.}{89}{-90}{2}{(2, 5.)}{\(\times \infty\)}
  \draw (-2.0, 3.1) -- (+2.0, 3.1);
  \draw (0, 3.3) -- (0, 3.1);
    \node at (0, 3.1) [below] {\(a\)};
  }
}

\newcommand{\molticonnome}{% 
  % Sezione con elementi separatori di cui due con nome
\disegno{
  \rettaappross
  \frecciav{-2.5}{-.4}{-1.2}{}
  \frecciav{2.5}{-0.4}{-1.2}{}
  \node at(-.8, .4)[above] {\(q_1\)};
  \node at(1.6, .4) [above] {\(q_2\)};
  \draw [<->] (-2.4, -1.2) -- node [below] {\(\frac{1}{n}\)} (2.4, -1.2);
  \microscopio{(0, .2)}{1.}{89}{-90}{2}{(2, 5.)}{\(\times \infty\)}
  \draw (-2.0, 3.1) -- (+2.0, 3.1);
  \foreach \x in {-1.2, -.6, ..., 1.2}
    \draw (\x, 3.3) -- (\x, 3.1);
    \node at (-.6, 3.1) [below] {\(\alpha\)};
    \node at (.6, 3.1) [below] {\(\beta\)};
  }
}

\newcommand{\nodoesp}[6]{% nodo di un'espressione numerica
  % esempio di chiamata:
  % \nodoesp{(-5, -1)}{(-4, -1)}{-4.5}{-3}{\times}{12}
  \def \popa{#1}
  \def \popb{#2}
  \def \xris{#3}
  \def \yris{#4}
  \def \op{#5}
  \def \ris{#6}
  \def \dimalf{\ndim/2}
  \def \ddim{\ndim/10}
  \def \xtopl{\xris-\dimalf}
  \def \xtopr{\xris+\dimalf}
  \def \ytop{\yris+2*\ndim}
  \def \ym{\yris+3*\dimalf}
  \draw \popa to [out=270, in=90] (\xris-3*\ddim, \ytop);
  \draw \popb to [out=270, in=90] (\xris+3*\ddim, \ytop);
  \draw (\xtopl, \ytop) -- (\xtopr, \ytop) -- (\xtopr, \ym) 
        arc (0:-180:\dimalf) -- cycle;
  \draw (\xris, \ym) node {\(\op\)}
        (\xris, \yris) node[draw, above, rectangle,rounded corners=1pt] 
                           {\(\ris\)};
%         (\xris, \yris) node[draw, above, rectangle] {\(\ris\)};
  
}

\newcommand{\espressionealberoa}{
  \def \la{-0.3}
  \def \lb{-2.8}
  \def \lc{-5.3}
  \def \ld{-7.8}
  \def \le{-10.3}
  \def \lf{-12.8}
  \def \lg{-14.2}
  \def \ndim{.94}
  \disegno{
    \draw (0, 0) node{
    \(2 ~+~ 6 ~\times~ 2 ~\div 
    \left[ \left(4 ~-~ 2 \right) \times~ 3^{2} ~-~ 3 ~\times~ 5 \right] ~+~
    \left( 5^{2} ~+~ 2^{3} \right) ~\div~ 3 =\)};
    \nodoesp{(-8.2, \la)}{(-6.5, \la)}{-7.4}{\lb}{\times}{12}
    \nodoesp{(-4.5, \la)}{(-2.9, \la)}{-3.7}{\lb}{-}{2}
    \draw (-3.7-.8, \lb) node [above=-2pt] {\((\)}
          (-3.7+.8, \lb) node [above=-2pt] {\()\)};
    \nodoesp{(-1.2, \la)}{(-0.8, +0.0)}{-1}{\lb}{\uparrow}{9}
    \nodoesp{(+0.9, \la)}{(+2.6, \la)}{+1.8}{\lb}{\times}{15}
    \nodoesp{(+4.8, \la)}{(+5.2, +0.0)}{+5.0}{\lb}{\uparrow}{25}
    \nodoesp{(+6.8, \la)}{(+7.2, +0.0)}{+7.0}{\lb}{\uparrow}{8}
    \nodoesp{(-3.7, \lb)}{(-1, \lb)}{-2}{\lc}{\times}{18}
    \nodoesp{(+5, \lb)}{(+7, \lb)}{+6}{\lc}{+}{33}
    \draw (+6-1, \lc) node [above=-2pt] {\((\)}
          (+6+1, \lc) node [above=-2pt] {\()\)};
    \nodoesp{(-2, \lc)}{(+1.8, \lb)}{0}{\ld}{-}{3}
    \draw (0-.8, \ld) node [above=-2pt] {\([\)}
          (0+.8, \ld) node [above=-2pt] {\(]\)};
    \nodoesp{(+6, \lc)}{(+9.2, \la)}{+8.2}{\ld}{\div}{11}
    \nodoesp{(-7.4, \lb)}{(0, \ld)}{-5.6}{\le}{\div}{4}
    \nodoesp{(-9.6, \la)}{(-5.6, \le)}{-9.0}{\lf}{+}{6}
    \nodoesp{(-9.0, \lf)}{(+8.2, \ld)}{+3.5}{\lg}{+}{17}
    \draw (+3.5, \lg) 
      node[draw, above, rectangle,rounded corners=1pt, very thick] 
          {\(\ris\)};
  }
}

\newcommand{\parentesi}[5]{
  \def \posx{#1}
  \def \posy{#2}
  \def \inter{#3}
  \def \pa{#4}
  \def \pb{#5}
  \draw (\posx-\inter, \posy) node [above=-2pt] {\(\pa\)}
        (\posx+\inter, \posy) node [above=-2pt] {\(\pb\)};
  
}

\newcommand{\espressionealberodia}{
  \def \la{-0.3}
  \def \lb{-2.8}
  \def \lc{-5.3}
  \def \ld{-7.8}
  \def \le{-10.3}
  \def \lf{-12.8}
  \def \lg{-14.2}
  \def \ndim{1.0}
  \def \xa{-10.55} \def \xb{-9.62} 
  \def \xc{-8.7} \def \xd{-7.85} \def \xe{-7.0} 
  \def \xf{-6.05} 
  \def \xg{-4.8} \def \xh{-3.9} \def \xi{-3.0} 
  \def \xj{-2.05} 
  \def \xk{-1.2} \def \xl{-1.0} \def \xm{-0.8} 
  \def \xn{+0.1} 
  \def \xo{+0.95} \def \xp{+1.9} \def \xq{2.7} 
  \def \xr{+3.95} 
  \def \xs{5.1} \def \xt{5.3} \def \xu{5.5} 
  \def \xv{6.4} 
  \def \xw{7.25} \def \xx{7.45} \def \xy{7.65} 
  \def \xz{8.8} \def \xaa{9.7} 
  \disegno{
%     \foreach \x/\l in {\xa/a, \xb/b, \xc/c, \xd/d, \xe/e, 
%                        \xf/f, \xg/g, \xh/h, \xi/i, \xj/j, 
%                        \xk/k, \xl/l, \xm/m, \xn/n, \xo/o, 
%                        \xp/p, \xq/q, \xr/r, \xs/s, \xt/t,
%                        \xu/u, \xv/v, \xw/w, \xx/x, \xy/y, 
%                        \xz/z, \xaa/a}{
%       \draw (\x, \la) circle(1pt) node [below] {\l};
%     }
    \draw (0, 0) node{
    \(2 ~+~ 6 ~\times~ 2 ~\div 
    \left[ \left(4 ~-~ 2 \right) \times~ 3^{2} ~-~ 3 ~\times~ 5 \right] ~+~
    \left( 5^{2} ~+~ 2^{3} \right) ~\div~ 3 =\)};
    \nodoesp{(\xc, \la)}{(\xe, \la)}{\xd}{\lb}{\times}{12}
    \nodoesp{(\xg, \la)}{(\xi, \la)}{\xh}{\lb}{-}{2}
    \parentesi{\xh}{\lb}{.8}{(}{)}
    \nodoesp{(\xk, \la)}{(\xm, +0.0)}{\xl}{\lb}{\uparrow}{9}
    \nodoesp{(\xo, \la)}{(\xq, \la)}{\xp}{\lb}{\times}{15}
    \nodoesp{(\xs, \la)}{(\xu, +0.0)}{\xt}{\lb}{\uparrow}{25}
    \nodoesp{(\xw, \la)}{(\xy, +0.0)}{\xx}{\lb}{\uparrow}{8}
    \nodoesp{(\xh, \lb)}{(\xl, \lb)}{\xj}{\lc}{\times}{18}
    \nodoesp{(\xt, \lb)}{(\xx, \lb)}{\xv}{\lc}{+}{33}
    \parentesi{\xv}{\lc}{1}{(}{)}
    \nodoesp{(\xj, \lc)}{(\xp, \lb)}{\xn}{\ld}{-}{3}
    \parentesi{\xn}{\ld}{.8}{[}{]}
    \nodoesp{(\xv, \lc)}{(\xaa, \la)}{\xz}{\ld}{\div}{11}
    \nodoesp{(\xd, \lb)}{(\xn, \ld)}{\xf}{\le}{\div}{4}
    \nodoesp{(\xa, \la)}{(\xf, \le)}{\xb}{\lf}{+}{6}
    \nodoesp{(\xb, \lf)}{(\xz, \ld)}{\xr}{\lg}{+}{17}
    \draw (\xr, \lg) 
      node[draw, above, rectangle,rounded corners=1pt, very thick] 
          {\(\ris\)};
  }
}

\def \fcolor{green!50!black}

\newcommand{\dmicx}[8]{% 
  % interno del microscopio posto sull'asse x.
  \def \basexa{#1}
  \def \basexb{#2}
  \def \basey{#3}
  \def \mxxa{#4}
  \def \mxxb{#5}
  \def \yab{#6}
  \def \eta{#7}
  \def \etb{#8}
  \draw (\basexa, \basey) -- (\basexb, \basey);
%   \fill [cyan!50]  (\xa, \yab) -- (\xa, \basey) -- 
%                    (\xb, \basey) -- (\xb, \yab) -- cycle;
  \draw [dashed] (\mxxa, \yab) -- (\mxxa, \basey) 
        node [below=1.5pt, xshift=\xsh, black] {\eta};
  \draw [dashed] (\mxxb, \yab) -- (\mxxb, \basey) 
        node [below, xshift=\xesh, black] {\etb};
}


\newcommand{\dmicf}[8]{% 
  % interno del microscopio posto sulla funzione.
  \def \mcol{#1}
  \def \basea{#2}  
  \def \baseb{#3} 
  \def \puntobase{#4} 
  \def \puntoa{#5} 
  \def \puntob{#6} 
  \def \dx{#7} 
  \def \df{#8}
  \path \puntoa node(pa) {} \puntob node(pb) {} \puntobase node(base) {};
%   \fill [fill=cyan!50] 
%         (pa -| base) -- (pa |- pa) -- (pa |- base) -- 
%         (pb |- base) -- (pb |- pb) -- (pb -| base) -- cycle;
  \draw [ultra thick, color=\mcol] \basea -- \baseb;
  \draw [dashed] (pa -| base) -- (pa |- pa) -- (pa |- base)
        (pb -| base) -- (pb |- pb) -- (pb |- base);
  \draw [thick] (pa |- pa) -- (pb |- pa)
        node [midway, below, black] {\dx}; %{\(\epsilon\)};
  \draw [thick] (pb |- pb) -- (pb |- pa)
        node [midway, right, color=\mcol] {\df}; % {\(df(x)_7\)};
}

\newcommand{\dmicy}[8]{% 
  % interno del microscopio posto sull'asse y.
  \def \baseya{#1} 
  \def \baseyb{#2} 
  \def \basex{#3}
  \def \ya{#4}
  \def \yb{#5}
  \def \xab{#6}
  \def \eta{#7}
  \def \etb{#8}
%   \fill [cyan!50]  (\xab, \ya) -- (\basex, \ya) -- 
%                    (\basex, \yb) -- (\xab, \yb) -- cycle;
  \draw (\basex, \baseya) -- (\basex, \baseyb);
  \draw [dashed] (\basex, \ya) node [left, \fcolor] {\eta} -- (\xab, \ya);
  \draw [dashed] (\basex, \yb) node [left, \fcolor] {\etb} -- (\xab, \yb);
}

\newcommand{\differenziale}{% 
  % definita in intervallo 0-inf.
  \def \xsh{-1mm}
  \def \xesh{+2.5mm}
  \disegno{
    \rcom{-1}{+8}{-5}{+7}{gray!50, very thin, step=1}
    \tkzInit[xmin=-1.3, xmax=+8.3, ymin=-5.3, ymax=+7.3]
    \tkzFct[ultra thick, \fcolor, domain=-1.3:+8.3]
            {.25*x*x-x-3}
    \draw [dashed] (7, 2.25) -- (7, 0) node [below, black] {\(x_0\)};
    \draw [dashed] (7, 2.25) -- (0, 2.25) node [left] {\(f(x_0)\)};
    \microscopio{(7, 0)}{1.5}{-60}{150}{2}{(11, -.3)}{\(\times \infty\)}
    \dmicx{7.65}{11.3}{-3.1}{9}{10}{-0.35}{\(x_0\)}{\(x_0+\epsilon\)}
    \microscopio{(7, 2.25)}{.5}{0}{180}{2}{(11, 4.2)}{\(\times  \infty\)}
    \dmicf{\fcolor}{(8.7, .4)}{(10.3, 4.1)}{(7.8, 0.34)}{(9, +1.1)}
        {(10, 3.4)} {\(\epsilon\)}{\(df(x_0)\)}
    \microscopio{(0, 2.25)}{.5}{0}{180}{2}{(4, 4.2)}{\(\times  \infty\)}
    \dmicy{0.25}{4.25}{2.51}{1.1}{3.4}{4.2}{\(f(x_0)\)}{\(f(x_0+\epsilon)\)}
  }
}

\newcommand{\teoremafonda}{% Teorema fond. incremento non infinitesimo.
  \def \k{2}
  \def \xi{-2.3}
  \def \yi{2}
  \def \xf{7.3}
  \def \yf{4}
  \def \xa{2.6}
  \def \ya{5.10}
  \def \xm{3}
  \def \ym{2.5}
  \def \xb{3.4}
  \def \yb{5.55}
  \def \label{p}
  \def \linea{[\fcolor] 
              (\xi, \yi) .. controls (-1, -1.1) and (3, 10) .. (\xf, \yf)
             }
  \disegno{
    \begin{scope}
      \clip (\xi, -2) rectangle (\xf+.2, 7.5);
      \fill [left color=red!10!black!5, right color=red!60!black!20] 
        \linea -- (\xf, 0) -- (\xi, 0) -- cycle;
      \fill [top color=green!40!black!30, bottom color=green!40!black!5] 
        (\xa, 0) -- (\xa, \ya) -- (\xb, \ya) -- (\xb, 0) -- cycle;
    \rcom{-2}{+7}{0}{+7}{gray!50, very thin, step=1}
    \draw [thick] \linea;
    \node at (-2, 2.5) {\(f\)};
    \draw (\xb, \yb) -- (\xb, \ya)
          (\xa, \ya) -- (\xa, 0) node [below, yshift=-8pt] {\(x\)}
          (\xb, 0) -- (\xb, \ya) -- (0, \ya) node [left] {\(f(x)\)};
    \node at (\xm, 0) [below] {\footnotesize \(\Delta t\)};
%     \draw [thin] (\xa, \ya) -- (0, \ya) node [left] {\(f(x)\)};
    \freccia{(3.9, \ym)}{(\xm-.1, \ym)}{right}{\Delta S}
    \end{scope}
  }
}

\newcommand{\micx}{% 
  % interno del microscopio posto sull'asse x.
  \draw [thick] (\mbordoax, \mybasex) -- (\mbordobx, \mybasex);
  \draw [thin] (\mxa, \myax) -- (\mxa, \mybasex) 
        node [below=1.5pt, black] {\(x\)};
  \draw [thin] (\mxb, \mybx) -- (\mxb, \mybasex) 
        node [below, black] {\(\xdx\)};
}

\newcommand{\micl}{% 
  % interno del microscopio posto su una linea verticale.
  \draw [thin] (\mxa, \mymial) -- (\mxa, \mymaal) 
               (\mxb, \mymibl) -- (\mxb, \mymabl)
               \posds node {\(\ds\)};
}


\newcommand{\micf}{% 
  % interno del microscopio posto sulla funzione.
  \path (\mxa, \myaf) node(pa) {} (\mxb, \mybf) node(pb) {};
  \draw [thick, \fcolor] \mbordoaf -- \mbordobf;
  \draw [thin] (\mxa, \mymiaf) -- (\mxa, \myaf) --
               (\mxb, \myaf) -- (\mxb, \mymibf);
  \draw [dashed] (\mxb, \mybf) -- (\mxb, \myaf)
                 (\mxb, \mybf) -- (\mxmibf, \mybf)
                 (\mxa, \myaf) -- (\mxmiaf, \myaf);
}

\newcommand{\micy}{% 
  % interno del microscopio posto sull'asse y.
  \draw [thick] (\mxbasey, \mbordoay) -- (\mxbasey, \mbordoby);
  \draw [dashed] 
    (\mxbasey, \myaf) node [left] {\(\fx\)} -- (\mxmaay, \myaf)
    (\mxbasey, \mybf) node [left] {\(\fxdx\)} -- 
    (\mxmaay, \mybf);
}

\newcommand{\teoremafondb}{% Teorema fondamentale incremento infinitesimo.
  \def \k{2}
  \def \xi{-2.3}
  \def \yi{2}
  \def \xf{7.3}
  \def \yf{4}
  \def \xa{2.6}
  \def \ya{5.10}
  \def \mxa{\xa+2.8}
  \def \mxb{\mxa+2}
  \def \mybasex{-2}
  \def \mybasel{1.5}
  \def \myaf{7.75}
  \def \mybf{8.75}
  \def \mbordoax{\xa+1.85}
  \def \mbordobx{\xa+5.65}
  \def \myax{0.37}
  \def \mybx{0.34}
  \def \mymial{1.86}
  \def \mymaal{5.37}
  \def \mymibl{1.9}
  \def \mymabl{5.32}
  \def \mbordoaf{(\xa+1.87, \ya+2.2)}
  \def \mbordobf{(\xa+5.5, \ya+4)}
  \def \mxmiaf{4.32}
  \def \mxmibf{4.37}
  \def \mymiaf{6.4}
  \def \mymibf{6.54}
  \def \mxbasey{+2.5}
  \def \mbordoay{+6.24}
  \def \mbordoby{+10.18}
  \def \mxmaay{4}
  \def \mxmaby{4}
  \def \mxmiay{0.32}
  \def \mxmiby{0.37}
  \def \xdx{x+dx}
  \def \fx{f(x)}
  \def \fxdx{f(x+dx)}
  \def \posds{(6.4, 3.7)}
  \def \ds{dS}
  \def \label{p}
  \def \linea{[\fcolor] 
              (\xi, \yi) .. controls (-1, -1.1) and (3, 10) .. (\xf, \yf)}
  \disegno{
    \begin{scope}
      \clip (\xi, 0) rectangle (\xf, 6);
      \fill [left color=red!10!black!5, right color=red!60!black!20] 
        \linea -- (\xf, 0) -- (\xi, 0) -- cycle;
    \end{scope}
    \rcom{-2}{+7}{0}{+7}{gray!50, very thin, step=1}
    \draw [thick] \linea;
    \node at (-2, 2.5) {\(f\)};
    \draw [thin] (0, \ya) --  (\xa, \ya) -- (\xa, 0); 
    \freccia{(\xa-.8, -0.65)}{(\xa, 0)}{below}{x}
    \freccia{(\xa+.8, -0.5)}{(\xa, 0)}{below}{\xdx}
    \freccia{(-0.5, \ya-.5)}{(0, \ya)}{left}{\fx}
    \freccia{(-0.5, \ya+.5)}{(0, \ya)}{left}{\fxdx}
    \begin{scope}[visible on=<2->] 
    \microscopio{(\xa, 0)}{2}{-20}{160}{2}{(8, .5)}{\(\times \infty\)}
    \begin{scope}
    \clip(+6.36, -1.36) circle (1.98);
    \fill [top color=green!40!black!15, bottom color=green!40!black!5] 
          (\mxa, \mybasex) rectangle (\mxb, \mybasex+2.7);
    \end{scope}
    \micx
    \microscopio{(\xa, 2.25)}{2}{20}{200}{2}{(4, 10)}{\(\times  \infty\)}
    \begin{scope}
    \clip(+6.36, +3.62) circle (1.98);
    \fill [top color=green!40!black!30, bottom color=green!40!black!20] 
          (\mxa, \mybasel) rectangle (\mxb, \mybasel+4.5);
    \end{scope}
    \micl
    \microscopio{(\xa, \ya)}{2.8}{+40}{220}{2}{(8, 10)}{\(\times  \infty\)}
    \begin{scope}
    \clip(+6.28, +8.18) circle (1.98);
    \fill [color=red!35!black!12] 
          (\mxa, \myaf)-- (\mxb, \myaf) -- (\mxb, \mybf) -- cycle;
    \fill [top color=green!40!black!45, bottom color=green!40!black!35] 
          (\mxa, \myaf-2.4) -- (\mxb, \myaf-2.4) -- (\mxb, \myaf) -- 
          (\mxa, \myaf) -- cycle;
    \end{scope}
    \micf
    \microscopio{(0, \ya)}{1.8}{50}{240}{2}{(8, 5.5)}{\(\times  \infty\)}
    \micy
    \end{scope}
  }
}

%--------------------------% Fne funzioni grafiche
















