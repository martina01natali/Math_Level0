%--------------------------
% Nuovi comandi grafici:

%--------------------------
% Inizializza Tikz con unitÃ  di misura 5mm, e realizza un disegno:

\newcommand{\disegno}[1]{
  % Esempio di chiamata:
  %% 
  \def \grafico{#1}
\begin{tikzpicture}[x=5mm, y=5mm, smooth]
  \grafico
\end{tikzpicture}
}
\newcommand{\disegnod}[2]{
  % Esempio di chiamata:
  %% 
  \def \dimensione{#1}
  \def \grafico{#2}
\begin{tikzpicture}[x=\dimensione mm, y=\dimensione mm, smooth]
  \grafico
\end{tikzpicture}
}

\newcommand{\vettoreNOTEXTdraw}[3]{% Disegna un vettore.
  % Esempio di chiamata:
  %% 
  \def \inizio{#1}
  \def \fine{#2}
  \def \parametri{#3}
  \draw [#3] [->] (\inizio) --++ (\fine);
}

\newcommand{\vettoredraw}[4]{% Disegna un vettore con un nome.
  % Esempio di chiamata:
  %% 
  \def \inizio{#1}
  \def \fine{#2}
  \def \etichetta{#3}
  \def \parametri{#4}
  \coordinate [label=$\Vec{\etichetta}$] (v) at ($((\inizio)+0.5*(\fine)$);
  \draw [#4] [->] (\inizio) --++ (\fine);
}

\newcommand{\vettoreABdraw}[5]{% Disegna un vettore con un nome.
  % Esempio di chiamata:
  %% 
  \def \etichettainizio{#1}
  \def \inizio{#2}
  \def \etichettafine{#3}
  \def \fine{#4}
  \def \parametri{#5}
  \coordinate [label=$\Vec{\etichettainizio\etichettafine}$] (N) at 
              ($(0.5*(\inizio)+0.5*(\fine)$);
  \coordinate [label=$\etichettainizio$] (A) at (\inizio);
  \coordinate [label=$\etichettafine$] (B) at (\fine);
  \draw [#5] [->] (\inizio) -- (\fine);
}

%--------------------------
% Assi e piano cartesiano
\newcommand{\asse}[4]{% Asse orizzontale.
  % Esempio di chiamata:
  %% \disegno{\asse{-7}{+7}{0}{\(t\)}
  \def \xmi{#1}
  \def \xma{#2}
  \def \posy{#3}
  \def \var{#4}
  \draw [-{Stealth[length=2mm, open, round]}] (\xmi, \posy) -- (\xma, \posy);
  \node [below] at (\xma, \posy) {\var};
}

\newcommand{\assex}[3]{% Asse x.
  % Esempio di chiamata:
  %% \disegno{\assex{-5}{+5}{0}}
  \asse{#1}{#2}{#3}{\(x\)};
}

\newcommand{\assecontrattini}[4]{% Asse.
  % Esempio di chiamata:
  %% \disegno{\assecontrattini{-7}{+7}{0}{\(t\)}
  \def \xmi{#1}
  \def \xma{#2}
  \def \posy{#3}
  \def \var{#4}
  \draw[gray!50, very thin, step=1] (\xmi, \posy-0.1) grid (\xma, \posy+0.1);
  \asse{#1}{#2}{#3}{#4};
}

\newcommand{\segmentocontrattini}[3]{% Segmento con trattini.
  % Esempio di chiamata:
  %% \disegno{\segmentocontrattini{-7}{+7}{0}
  \def \xmi{#1}
  \def \xma{#2}
  \def \posy{#3}
  \pgfmathsetmacro \endx{int(\xma-\xmi)}
  \foreach \x in {0, 1, ..., \endx}
    \draw[very thin] (\xmi+\x, \posy-0.1) -- (\xmi+\x, \posy+0.1);
  \draw [-] (\xmi-.3, \posy) -- (\xma+.3, \posy);
}

\newcommand{\rcomvar}[7]{% Riferimento Cartesiano Ortogonale Monometrico.
  % Esempio di chiamata:
  %% \disegno{\rcomvar{-7}{+7}{-11}{+10}{gray!50, very thin, step=1}}{t}{s}
  \def \xmi{#1}
  \def \xma{#2}
  \def \ymi{#3}
  \def \yma{#4}
  \def \griglia{#5}
  \def \vascissa{#6}
  \def \vordinata{#7}
  \draw[#5] (\xmi-0.3, \ymi-0.3) grid (\xma+0.3, \yma+0.3); % Griglia
  \begin{scope}[-{Stealth[length=2mm, open, round]}, black] % Assi
    \draw (\xmi-0.3, 0) -- (\xma+0.5, 0) 
      node [below, xshift=-3pt] {\vascissa};
    \draw (0, \ymi-0.3) -- (0, \yma+0.5) 
      node [left, yshift=-3pt] {\vordinata};
  \end{scope}
}
\newcommand{\rcom}[5]{% Riferimento Cartesiano Ortogonale Monometrico: x-y.
  % Esempio di chiamata:
  %% \disegno{\rcom{-7}{+7}{-11}{+10}{gray!50, very thin, step=1}}
  \rcomvar{#1}{#2}{#3}{#4}{#5}{\(x\)}{\(y\)}
}

% \newcommand{\rcom}[5]{% Riferimento Cartesiano Ortogonale Monometrico: x-y.
%   % Esempio di chiamata:
%   %% \disegno{\RCOM{-7}{+7}{-11}{+10}{gray!50, very thin, step=1}}
% % \begin{tikzpicture}[x=5mm, y=5mm, smooth]
%   \def \xmi{#1}
%   \def \xma{#2}
%   \def \ymi{#3}
%   \def \yma{#4}
%   \def \griglia{#5}
%   \draw[#5] (\xmi-0.3, \ymi-0.3) grid (\xma+0.3, \yma+0.3); % Griglia
%   \begin{scope}[-{Stealth[length=2mm, open, round]}, black] % Assi
%     \draw (\xmi-0.3, 0) -- (\xma+0.3, 0) node [below] {$x$};
%     \draw (0, \ymi-0.3) -- (0, \yma+0.3) node [left] {$y$};
%   \end{scope}
% % \end{tikzpicture}
% 
% % \newcommand{\RCOM}[5]{% Coordinate cartesiane ortogonali: x-y.
% % \begin{tikzpicture}[x=5mm, y=5mm, smooth]
% %   \def \xmi{#1}
% %   \def \xma{#2}
% %   \def \ymi{#3}
% %   \def \yma{#4}
% %   \def \griglia{#5}
% %   \coordinate [label=$x$] (x) at (\xma, 0);     
% %   \draw [-{Stealth[length=2mm, open, round]}] (\xmi, 0) -- (\xma, 0);
% %   \coordinate [label=$y$] (y) at (0, \yma);	
% %   \draw [-{Stealth[length=2mm, open, round]}] (0, \ymi) -- (0, \yma);
% %   \draw [#5] (\xmi, \ymi) grid (\xma, \yma);
% % \end{tikzpicture}
% }

% \newcommand{\rcomvario}[7]{% Rif. Cart. Ort. Mon.: v_ind-v_dip.
%   % Esempio di chiamata:
%   %% \disegno{\RCOMvario{0}{6}{0}{6}{gray!50, very thin, step=1}{t}{v}}
%   \def \xmi{#1}
%   \def \xma{#2}
%   \def \ymi{#3}
%   \def \yma{#4}
%   \def \griglia{#5}
%   \def \vind{#6}
%   \def \vdip{#7}
%   \draw [#5] (\xmi, \ymi) grid (\xma, \yma);
%   \coordinate [label=$\vind$] (x) at (\xma, 0);     
%   \draw [-{Stealth[length=2mm, open, round]}] (\xmi, 0) -- (\xma, 0);
%   \coordinate [label=$\vdip$] (y) at (0, \yma);     
%   \draw [-{Stealth[length=2mm, open, round]}] (0, \ymi) -- (0, \yma);
% }

\newcommand{\testodraw}[3]{% Scrive un testo.
  % Esempio di chiamata:
  %% 
	\def \testo{#1}
	\def \posizione{#2}
	\def \parametri{#3}
	\coordinate [label={ #3 $\testo$}] (T) at (\posizione);
}

\newcommand{\angolodraw}[4]{% Disegna un arco.
  % Esempio di chiamata:
  %% 
	\def \centro{#1}
	\def \angoloi{#2}
	\def \raggio{#3}
	\def \angolof{#4}
	\draw (\centro) ++(\angoloi:\angolof) arc (\angoloi:\raggio:\angolof);
}

\newcommand{\molla}[4]{% Disegna una molla.
  % Esempio di chiamata:
  %% 
	\def \posizione{#1}
	\def \lunghezza{#2}
	\def \ampiezza{#3}
	\def \angolo{#4}
	\draw [rotate=\angolo, shift={(\posizione)}]
	(0,-0.5*\ampiezza) --(0,0.5*\ampiezza);
	\draw plot [variable=\t, domain=45:7245, smooth, rotate=\angolo, 
	shift={(\posizione)}] 
	({\lunghezza*0.0001388*\t}, {\ampiezza*(sin(\t)^2-0.5)});
}

%--------------------------
% Funzioni per i grafi delle disequazioni

\newcommand{\cerchietto}[2]{% Cerchietto
  % Esempio di chiamata:
  %% \cerchietto{-5/3}{0}
  \def \parposx{#1}
  \def \parposy{#2}
  \def \dim{.25}
  \draw (\parposx, \parposy) circle (\dim);
}

\newcommand{\crocetta}[2]{% Crocetta
  % Esempio di chiamata:
  %% \crocetta{+5/3}{0}
  \def \parposx{#1}
  \def \parposy{#2}
  \def \dim{.25}
  \draw (\parposx-\dim,  \parposy-\dim) -- (\parposx+\dim, \parposy+\dim) 
        (\parposx-\dim,  \parposy+\dim) -- (\parposx+\dim, \parposy-\dim);
}

\newcommand{\segnitreassiduepunti}[7]{% Grafo calcolo del segno con tre assi
  % Esempio di chiamata:
  %% \segnitreassiduepunti{5}{1.2}
  %%                      {\(8x-1\)}{\(x+1\)}{\(f(x)\)}
  %%                      {\(-1\)}{\(\frac{1}{8}\)}
  \def \dimx{#1}
  \def \dimy{#2}
  \def \primaesp{#3}
  \def \secondaesp{#4}
  \def \terzaesp{#5}
  \def \primoval{#6}
  \def \secondoval{#7}
  \def \posx{\dimx / 3}
  \def \posy{0}          % \posy inchioda la compilazione!!!!!!!!!!!??????????
  \def \posv{0}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [above] {\primaesp};
  \def \posv{-\dimy}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [above] {\secondaesp};
  \def \posv{-2*\dimy}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [above] {\terzaesp};
  \draw [-] (-\posx, \posv) -- (-\posx, \dimy) node [above] {\primoval};
  \draw [-] (+\posx, \posv) -- (+\posx, \dimy) node [above] {\secondoval};
}

\newcommand{\sistematreassitrepunti}[8]{% Grafo per un sistema di disequazioni
  % Esempio di chiamata:
  %% \sistematreassitrepunti{5}{1.2}
  %%                        {\(D_1\)}{\(D_2\)}{\(D_1 \wedge D_2\)}
  %%                        {\(-1\)}{\(\frac{1}{8}\)}{\(\frac{2}{7}\)}
  \def \dimx{#1}
  \def \dimy{#2}
  \def \primaesp{#3}
  \def \secondaesp{#4}
  \def \terzaesp{#5}
  \def \primoval{#6}
  \def \secondoval{#7}
  \def \terzoval{#8}
  \def \posx{\dimx / 2}
  \def \posy{0}          % \posy inchioda la compilazione!!!!!!!!!!!??????????
  \def \posv{0}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [left] {\primaesp};
  \def \posv{-\dimy}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [left] {\secondaesp};
  \def \posv{-2*\dimy}
  \assex{-\dimx}{+\dimx}{\posv}
  \draw (-\dimx, \posv) node [left] {\terzaesp};
  \draw [-] (-\posx, \posv) -- (-\posx, \dimy) node [above] {\primoval};
  \draw [-] (0, \posv) -- (0, \dimy) node [above] {\secondoval};
  \draw [-] (+\posx, \posv) -- (+\posx, \dimy) node [above] {\terzoval};
}

%--------------------------
% Funzioni per gli strumenti grafici

\newcommand{\microscopio}[7]{% 
  % Esempio di chiamata:
  % \microscopio{punto}{lung}{angoloa}{angolob}{raggio}
  %             {postoetichetta}{etichetta}
  % \microscopio{(8, 5)}{2}{120}{-50}{2}{(7.6, 10)}{\infty}
  \def \punto{#1}
  \def \lung{#2}
  \def \anga{#3}
  \def \angb{#4}
  \def \rad{#5}
  \def \postimes{#6}
  \def \labeltimes{#7}
  \draw [fill=white] \punto -- +(\anga: \lung)
  arc [start angle=\angb, delta angle=350, radius=\rad] -- cycle;
  \node at \postimes {\labeltimes};
}

\tikzset{
  telescopio/.pic={% Disegna un telescopio non standard
  % Esempio di chiamata:
  % \draw (-1, 2) pic [rotate=27, telescopio=\infty] {telescopio};
  \begin{scope}[ultra thick]
    \draw [fill=black, rounded corners=2] (5.4, -1.4) rectangle (6.9, -0.4);
    \draw [rounded corners=2] (1.4, -1.3) rectangle (5.6, -0.5);
    \draw (0.4, -1.2) rectangle (1.4, -0.6);
    \draw [fill=white] (0.8, -1.2) circle (0.2);
    \draw [fill=black, rounded corners=1] 
      (0.4, -1.3) -- (0.4, -0.5) -- (-0.45, -0.5) -- cycle;
    \draw (-0.2, -0.5) rectangle (0.2, -0.2);
    \draw [fill=black, rounded corners=1] (-0.3, -0.2) rectangle (0.3, 0);
    \draw [-{Stealth[length=2mm, open, round]}] (7.2, -.9) -- (8.2, -.9) 
      node [right, yshift=1mm] {#1};
  \end{scope}
  }
}
